{% extends 'examigo/base.html' %}

{% block title %}ExAmigo - Home{% endblock %}

{% block extra_css %}
<style>
    /* Global Styles */
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(to right, #f5f7fa, #c3cfe2);
        display: flex;
        flex-direction: column;
    }

    /* Navbar Styles are in base.html */

    /* Main Content Styles */
    .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding-top: 100px;
        text-align: center;
    }

    .main-content h1 {
        font-size: 3rem;
        color: #000000;
        margin-bottom: 20px;
        animation: fadeInDown 1s ease;
    }

    .main-content p {
        font-size: 1.2rem;
        color: #000000;
        max-width: 600px;
        line-height: 1.6;
        animation: fadeIn 1.5s ease;
    }

    /* FYP Info Section */
    .fyp-info {
        padding: 20px;
        border-radius: 7px;
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
        margin-bottom: 50px;
        animation: fadeInUp 1s ease;
        justify-content: space-between;
        margin: 30px 3px;
        height: 600px;
    }

    .fyp-info .info-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
    }

    .fyp-info .info-text {
        flex: 1;
        min-width: 300px;
    }

    .fyp-info .info-text h1 {
        color: #000000;
        margin-bottom: 10px;
        font-size: 2.5rem;
    }

    .fyp-info .info-text p {
        color: #000000;
        line-height: 1.8;
    }

    .info-animation {
        transform: translateY(-200px);
        transition: transform 0.1s ease-in-out;
        display: flex;
        justify-content: center;
    }

    .fyp-flex {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
    }

    dotlottie-player {
        flex: 1;
        max-width: 450px;
        margin: 20px auto;
        justify-content: right;
        width: 400px;
        height: auto;
        margin-right: 20px;
    }

    .after-info {
        padding: 25px 30px;
        border-radius: 12px;
        margin: 40px auto;
        max-width: 700px;
        text-align: center;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .after-info h2 {
        font-size: 2rem;
        color: #09456e;
        margin-bottom: 10px;
    }

    .after-info p {
        font-size: 1.2rem;
        color: #333;
    }

    /* Role Selection Blocks */
    .login-options {
        padding-top: 50px;
        display: flex;
        gap: 40px;
        justify-content: center;
    }

    .login-options .block {
        background-color: rgba(255, 255, 255, 0.95);
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        text-align: center;
        transition: transform 0.3s, box-shadow 0.3s;
        border: 3px solid #09456e;
    }

    .login-options .block:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    }

    .login-options .block h2 {
        font-size: 1.8rem;
        margin-bottom: 20px;
    }

    .login-options .block button {
        background-color: #007bff;
        color: #fff;
        border: none;
        padding: 10px 30px;
        border-radius: 30px;
        font-size: 1rem;
        cursor: pointer;
        transition: background-color 0.3s ease;
        width: 100%;
        border: 2px solid #09456e;
    }

    .login-options .block button:hover {
        background-color: #0056b3;
    }

    .login-options .block .button-container {
        display: flex;
        justify-content: space-between;
        gap: 10px;
    }

    .login-options .block button {
        flex: 1;
        border-radius: 30px;
        padding: 10px 0;
    }

    /* Keyframes for Animations */
    @keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .main-content h1 {
            font-size: 2.2rem;
        }
        .fyp-info .info-text h1 {
            font-size: 2rem;
        }
        .login-options {
            flex-direction: column;
            gap: 20px;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Main Content -->
<div class="main-content">
    <h1>Welcome to ExAmigo!</h1>
    <p>Where Learning Meets Innovation! üìö</p>
</div>

<!-- FYP Info Section -->
<section class="fyp-info" id="home">
    <div class="fyp-flex">
        <div class="info-text">
            <h1>üí° Learn with us!</h1>
            <p>At ExAmigo, we don't just help you study ‚Äî we help you excel. Our AI-powered quiz generator crafts customized quizzes tailored just for you!</p>
            <p>‚úÖ Create quizzes in seconds</p>
            <p>‚úÖ Practice with MCQs, True/False, and Subjective questions</p>
            <p>‚úÖ Get instant feedback and smart grading</p>
            <p>‚úÖ Learn more. Stress less. üìù</p>
        </div>
        <div class="info-animation">
            <dotlottie-player
                src="https://lottie.host/53285b1e-2085-4c4b-88e2-a732ff797d82/RgG204nbz1.lottie"
                background="transparent"
                speed="1"
                style="width: 500px; height: 500px; margin-top: 20px; transform: translateY(-20px);"
                loop
                autoplay
            ></dotlottie-player>
        </div>
    </div>
</section>

<div class="after-info">
    <h2>Start your journey now!</h2>
    <p><em>Sign up as a student or teacher and see the magic unfold.</em></p>
</div>

{% if not user.is_authenticated %}
<!-- Login Options -->
<section class="login-options">
    <div class="block student-block">
        <img src="https://img.icons8.com/color/100/000000/student-male.png" alt="Student Icon">
        <h2>Student</h2>
        <p>Access personalized quizzes and track your progress as a student!</p>
        <div class="button-container">
            <a href="{% url 'login' %}?role=student" class="btn btn-primary">Login</a>
            <a href="{% url 'register' %}?role=student" class="btn btn-secondary">Registration</a>
        </div>
    </div>

    <div class="block teacher-block">
        <img src="https://img.icons8.com/color/100/000000/teacher.png" alt="Teacher Icon">
        <h2>Teacher</h2>
        <p>Create and manage quizzes to enhance your students' learning experience.</p>
        <div class="button-container">
            <a href="{% url 'login' %}?role=teacher" class="btn btn-primary">Login</a>
            <a href="{% url 'register' %}?role=teacher" class="btn btn-secondary">Registration</a>
        </div>
    </div>
</section>
{% else %}
<!-- Document cards section -->
<div class="row">
    <div class="col-12">
        <h4 class="mb-3">Your Documents</h4>
    </div>
</div>
<div class="row">
    {% for document in documents %}
        <div class="col-md-6 col-lg-4 mb-3">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">{{ document.title }}</h5>
                    <p class="card-text">Uploaded on: {{ document.upload_date|date:"F d, Y" }}</p>
                    <div class="btn-group w-100">
                        <a href="{% url 'generate_quiz' document.id %}" class="btn btn-primary">Generate Quiz</a>
                        <a href="{% url 'document_chat' document.id %}" class="btn btn-success">
                            <i class="bi bi-chat-dots"></i> Talk to AI Instructor
                        </a>
                    </div>
                </div>
            </div>
        </div>
    {% empty %}
        <div class="col-12">
            <div class="alert alert-info text-center">
                You haven't uploaded any documents yet. <a href="{% url 'upload_document' %}">Upload your first document</a> to start generating quizzes!
            </div>
        </div>
    {% endfor %}
</div>

<div class="row mt-4">
    <!-- Recent Documents -->
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="card-title mb-0">Recent Documents</h5>
            </div>
            <div class="card-body">
                {% if documents %}
                    <ul class="list-group list-group-flush">
                        {% for document in documents %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <span>{{ document.title }}</span>
                                    <small class="text-muted d-block">
                                        {% if document.uploaded_at %}
                                            {{ document.uploaded_at|date:"M d, Y" }}
                                        {% else %}
                                            {{ document.upload_date|date:"M d, Y" }}
                                        {% endif %}
                                    </small>
                                </div>
                                <div class="btn-group">
                                    <a href="{% url 'generate_quiz' document.id %}" class="btn btn-sm btn-outline-primary">Quiz</a>
                                    <a href="{% url 'document_chat' document.id %}" class="btn btn-sm btn-outline-success">
                                        <i class="bi bi-chat-dots"></i> Chat
                                    </a>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-center text-muted">No documents uploaded yet.</p>
                    <div class="text-center">
                        <a href="{% url 'upload_document' %}" class="btn btn-primary">Upload Now</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Rest of the authenticated user dashboard -->
    <!-- (Keeping the original dashboard structure from your second template) -->
    <!-- Recent Quizzes -->
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="card-title mb-0">Recent Quizzes</h5>
            </div>
            <div class="card-body">
                {% if recent_quizzes %}
                    <ul class="list-group list-group-flush">
                        {% for quiz in recent_quizzes %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <span>{{ quiz.title }}</span>
                                    <small class="text-muted d-block">{{ quiz.created_at|date:"M d, Y" }} - {{ quiz.difficulty }}</small>
                                </div>
                                <a href="{% url 'take_quiz' quiz.id %}" class="btn btn-sm btn-outline-primary">Take Quiz</a>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-center text-muted">No quizzes created yet.</p>
                    {% if documents %}
                        <div class="text-center">
                            <a href="{% url 'generate_quiz' documents.0.id %}" class="btn btn-primary">Create Quiz</a>
                        </div>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Recent Attempts -->
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="card-title mb-0">Recent Attempts</h5>
            </div>
            <div class="card-body">
                {% if recent_attempts %}
                    <ul class="list-group list-group-flush">
                        {% for attempt in recent_attempts %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <span>{{ attempt.quiz.title }}</span>
                                    <small class="text-muted d-block">
                                        {{ attempt.started_at|date:"M d, Y" }}
                                        {% if attempt.score is not None %}
                                            - Score: {{ attempt.score }}%
                                        {% else %}
                                            - In Progress
                                        {% endif %}
                                    </small>
                                </div>
                                {% if attempt.completed_at %}
                                    <a href="{% url 'view_results' attempt.id %}" class="btn btn-sm btn-outline-success">Results</a>
                                {% else %}
                                    <a href="{% url 'take_quiz' attempt.quiz.id %}" class="btn btn-sm btn-outline-warning">Continue</a>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-center text-muted">No quiz attempts yet.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
{% endblock %}